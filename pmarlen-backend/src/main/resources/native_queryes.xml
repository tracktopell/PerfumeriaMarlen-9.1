<?xml version="1.0" encoding="UTF-8"?>
<native_queryes>
    <nativequery id="verPedidos">
        <sql>
<![CDATA[
SELECT    R1.ID,R1.ESTADO_ID,R1.FECHA,R1.NOMBRE_COMPLETO,R1.NUM_ELEMENTOS,R1.SUCURSAL_NOMBRE,R1.TIPO_ALMACEN,R1.RFC,R1.RAZON_SOCIAL,R1.NOMBRE_ESTABLECIMIENTO,R1.FORMA_DE_PAGO_DESCRIPCION, R1.MEDIO_DE_PAGO_DESCRIPCION,R1.DESCUENTO_APLICADO,R1.PORCENTAJE_DESCUENTO_CALCULADO,R1.PORCENTAJE_DESCUENTO_EXTRA,R1.IMPORTE_PEDIDO,R1.IMPORTE_FINAL_PEDIDO,R1.ESTADO_DESCRIPOCION,R1.FACTORIVA 
FROM ( 
    SELECT    PV.ID,PVE.ESTADO_ID,PVE.FECHA,U.NOMBRE_COMPLETO,COUNT(1) AS NUM_ELEMENTOS,S.NOMBRE AS SUCURSAL_NOMBRE,A.TIPO_ALMACEN,C.RAZON_SOCIAL,C.NOMBRE_ESTABLECIMIENTO,C.RFC,FP.DESCRIPCION AS FORMA_DE_PAGO_DESCRIPCION, MP.DESCRIPCION AS MEDIO_DE_PAGO_DESCRIPCION,PV.DESCUENTO_APLICADO,PV.PORCENTAJE_DESCUENTO_CALCULADO,PV.PORCENTAJE_DESCUENTO_EXTRA,(SUM(PVD.CANTIDAD*PVD.PRECIO_VENTA)) AS IMPORTE_PEDIDO,(SUM(PVD.CANTIDAD*PVD.PRECIO_VENTA))*(1.0-PV.DESCUENTO_APLICADO) AS IMPORTE_FINAL_PEDIDO,E.DESCRIPCION AS ESTADO_DESCRIPOCION,PV.FACTORIVA 
    FROM      PEDIDO_VENTA_ESTADO PVE, 
              PEDIDO_VENTA PV, 
              PEDIDO_VENTA_DETALLE PVD, 
              CLIENTE C, 
              FORMA_DE_PAGO FP, 
              METODO_DE_PAGO MP, 
              ALMACEN A, 
              SUCURSAL S, 
              USUARIO U, 
              ESTADO E             
    WHERE     1=1 
    AND       PV.ID                = PVE.PEDIDO_VENTA_ID 
    AND       PV.CLIENTE_ID        = C.ID 
    AND       PV.FORMA_DE_PAGO_ID  = FP.ID 
    AND       PV.METODO_DE_PAGO_ID = MP.ID 
    AND       PV.ID                = PVE.PEDIDO_VENTA_ID 
    AND       PV.ID                = PVD.PEDIDO_VENTA_ID 
    AND       PV.ALMACEN_ID        = A.ID 
    AND       A.SUCURSAL_ID        = S.ID 
    AND       PVE.USUARIO_MODIFICO = U.USUARIO_ID 
    AND       PVE.ESTADO_ID        = E.ID 
    GROUP BY  PV.ID, PVE.ESTADO_ID 
) AS R1, 
( 
    SELECT    PEDIDO_VENTA_ID,MAX(ESTADO_ID) AS ACTUAL_ESTADO_ID 
    FROM      PEDIDO_VENTA_ESTADO PVE, 
              PEDIDO_VENTA PV 
    WHERE     1=1 
    AND       PV.ID         = PVE.PEDIDO_VENTA_ID 
    GROUP BY  PV.ID 
) AS R2 
WHERE 1=1 
AND R1.ID = R2.PEDIDO_VENTA_ID 
AND R1.R1.ESTADO_ID = R2.ACTUAL_ESTADO_ID 
ORDER BY R1.ID DESC
]]>
        </sql>
    </nativequery>
	
	<nativequery id="verPedidos2">
        <sql>
<![CDATA[
SELECT    R1.ID,R1.ESTADO_ID,R1.FECHA,R1.NOMBRE_COMPLETO,R1.NUM_ELEMENTOS,R1.SUCURSAL_NOMBRE,R1.TIPO_ALMACEN,R1.RFC,R1.RAZON_SOCIAL,R1.NOMBRE_ESTABLECIMIENTO,
                 R1.FORMA_DE_PAGO_DESCRIPCION, R1.MEDIO_DE_PAGO_DESCRIPCION,R1.DESCUENTO_APLICADO,R1.PORCENTAJE_DESCUENTO_CALCULADO,R1.PORCENTAJE_DESCUENTO_EXTRA,R1.IMPORTE_PEDIDO,
                 R1.IMPORTE_FINAL_PEDIDO,R1.ESTADO_DESCRIPOCION,R1.FACTORIVA,R1.CFD_VENTA_ID,R1.CFD_ULTIMA_ACTUALIZACION,R1.CONTAINS_CONTENIDO_ORIGINAL_XML,R1.CFD_CALLING_ERROR_RESULT
FROM ( 
    SELECT    PV.ID,PVE.ESTADO_ID,PVE.FECHA,U.NOMBRE_COMPLETO,COUNT(1) AS NUM_ELEMENTOS,S.NOMBRE AS SUCURSAL_NOMBRE,A.TIPO_ALMACEN,C.RAZON_SOCIAL,C.NOMBRE_ESTABLECIMIENTO,
                       C.RFC,FP.DESCRIPCION AS FORMA_DE_PAGO_DESCRIPCION, MP.DESCRIPCION AS MEDIO_DE_PAGO_DESCRIPCION,PV.DESCUENTO_APLICADO,PV.PORCENTAJE_DESCUENTO_CALCULADO,
                       PV.PORCENTAJE_DESCUENTO_EXTRA,(SUM(PVD.CANTIDAD*PVD.PRECIO_VENTA)) AS IMPORTE_PEDIDO,(SUM(PVD.CANTIDAD*PVD.PRECIO_VENTA))*(1.0-PV.DESCUENTO_APLICADO) 
					   AS IMPORTE_FINAL_PEDIDO,E.DESCRIPCION AS ESTADO_DESCRIPOCION,PV.FACTORIVA,PV.CFD_VENTA_ID,CFD.ULTIMA_ACTUALIZACION as CFD_ULTIMA_ACTUALIZACION, 
					   CFD.CONTENIDO_ORIGINAL_XML IS NULL AS CONTAINS_CONTENIDO_ORIGINAL_XML, CFD.CALLING_ERROR_RESULT AS CFD_CALLING_ERROR_RESULT
    FROM      PEDIDO_VENTA_ESTADO PVE, 
              PEDIDO_VENTA PV LEFT JOIN CFD_VENTA CFD ON PV.CFD_VENTA_ID  = CFD.ID, 
              PEDIDO_VENTA_DETALLE PVD, 
              CLIENTE C, 
              FORMA_DE_PAGO FP, 
              METODO_DE_PAGO MP, 
              ALMACEN A, 
              SUCURSAL S, 
              USUARIO U, 
              ESTADO E             
    WHERE     1=1 
    AND       PV.ID                = PVE.PEDIDO_VENTA_ID 
    AND       PV.CLIENTE_ID        = C.ID 
    AND       PV.FORMA_DE_PAGO_ID  = FP.ID 
    AND       PV.METODO_DE_PAGO_ID = MP.ID 
    AND       PV.ID                = PVE.PEDIDO_VENTA_ID 
    AND       PV.ID                = PVD.PEDIDO_VENTA_ID 
    AND       PV.ALMACEN_ID        = A.ID 
    AND       A.SUCURSAL_ID        = S.ID 
    AND       PVE.USUARIO_MODIFICO = U.USUARIO_ID 
    AND       PVE.ESTADO_ID        = E.ID 
    GROUP BY  PV.ID, PVE.ESTADO_ID 
) AS R1, 
( 
    SELECT    PEDIDO_VENTA_ID,MAX(ESTADO_ID) AS ACTUAL_ESTADO_ID 
    FROM      PEDIDO_VENTA_ESTADO PVE, 
              PEDIDO_VENTA PV 
    WHERE     1=1 
    AND       PV.ID         = PVE.PEDIDO_VENTA_ID 
    GROUP BY  PV.ID 
) AS R2 
WHERE 1=1 
AND R1.ID = R2.PEDIDO_VENTA_ID 
AND R1.R1.ESTADO_ID = R2.ACTUAL_ESTADO_ID 
ORDER BY R1.ID DESC
LIMIT :limitRows
]]>
        </sql>
    </nativequery>
	
    <nativequery id="inventarios">
        <sql>
<![CDATA[
SELECT S.ID SUCURSAL_ID,A.ID ALMACEN_ID,A.TIPO_ALMACEN,P.ID,P.CODIGO_BARRAS,P.NOMBRE,P.PRESENTACION,
       M.NOMBRE AS MARCA_NOMBRE,I.NOMBRE AS INDUSTRIA_NOMBRE ,L.NOMBRE AS LINEA_NOMBRE,AP.CANTIDAD_ACTUAL,
       AP.PRECIO_VENTA,AP.COSTO,AP.PRECIO_MAYOREO
FROM   PRODUCTO P,MARCA M, INDUSTRIA I,LINEA L, ALMACEN_PRODUCTO AP,ALMACEN A,SUCURSAL S
WHERE  1=1
AND    P.MARCA_ID = M.ID
AND    M.INDUSTRIA_ID = I.ID
AND    M.LINEA_ID = L.ID
AND    P.ID       = AP.PRODUCTO_ID
AND    AP.ALMACEN_ID = A.ID
AND    A.SUCURSAL_ID = S.ID
AND    S.ID = 1
AND    A.TIPO_ALMACEN=:almacenId
ORDER  BY LINEA_NOMBRE, INDUSTRIA_NOMBRE, MARCA_NOMBRE, NOMBRE, PRESENTACION
]]>
        </sql>
    </nativequery>

    <nativequery id="inventarioEspecifico">
        <sql>
<![CDATA[
SELECT S.ID SUCURSAL_ID,A.ID ALMACEN_ID,A.TIPO_ALMACEN,P.ID,P.CODIGO_BARRAS,P.NOMBRE,P.PRESENTACION,
       M.NOMBRE AS MARCA_NOMBRE,I.NOMBRE AS INDUSTRIA_NOMBRE ,L.NOMBRE AS LINEA_NOMBRE,AP.CANTIDAD_ACTUAL,
       AP.PRECIO_VENTA,AP.COSTO,AP.PRECIO_MAYOREO
FROM   PRODUCTO P,MARCA M, INDUSTRIA I,LINEA L, ALMACEN_PRODUCTO AP,ALMACEN A,SUCURSAL S
WHERE  1=1
AND    P.MARCA_ID = M.ID
AND    M.INDUSTRIA_ID = I.ID
AND    M.LINEA_ID = L.ID
AND    P.ID       = AP.PRODUCTO_ID
AND    AP.ALMACEN_ID = A.ID
AND    A.SUCURSAL_ID = S.ID
AND    S.ID = 1
AND    A.TIPO_ALMACEN=:almacenId
AND    P.CODIGO_BARRAS=:codigoBarras
ORDER  BY LINEA_NOMBRE, INDUSTRIA_NOMBRE, MARCA_NOMBRE, NOMBRE, PRESENTACION
]]>
        </sql>
    </nativequery>

	<nativequery id="movimientoHistoricoRroductoEyS">
        <sql>
<![CDATA[
SELECT MHP.ALMACEN_ID ,MHP.PRODUCTO_ID,P.CODIGO_BARRAS,MHP.FECHA,MHP.TIPO_MOVIMIENTO_ID, TM.DESCRIPCION,MHP.CANTIDAD,MHP.COSTO,MHP.PRECIO,MHP.USUARIO_ID
FROM   MOVIMIENTO_HISTORICO_PRODUCTO MHP, PRODUCTO P , TIPO_MOVIMIENTO TM
WHERE  1=1
AND    MHP.ALMACEN_ID=:almacenId
AND    MHP.PRODUCTO_ID = P.ID
AND    MHP.TIPO_MOVIMIENTO_ID = TM.ID
AND    MHP.TIPO_MOVIMIENTO_ID BETWEEN 20 AND 40
AND    P.CODIGO_BARRAS=:productoCodigoBarras
ORDER BY MHP.FECHA
]]>
        </sql>
    </nativequery>
				
								
</native_queryes>
